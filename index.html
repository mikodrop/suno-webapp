<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VibeCraft Studio</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            background-color: var(--tg-theme-bg-color, #181818);
            color: var(--tg-theme-text-color, #ffffff);
            font-family: sans-serif;
            padding: 16px;
            margin: 0;
            box-sizing: border-box;
        }
        .container { display: flex; flex-direction: column; gap: 16px; }
        
        label { font-weight: 600; font-size: 14px; margin-bottom: 6px; display: block; color: var(--tg-theme-hint-color, #aaa); }
        
        input, textarea {
            width: 100%;
            padding: 12px;
            border-radius: 12px;
            border: 1px solid #333;
            background-color: var(--tg-theme-secondary-bg-color, #2a2a2a);
            color: var(--tg-theme-text-color, #fff);
            font-size: 16px;
            resize: none;
            box-sizing: border-box;
            outline: none;
            transition: border-color 0.2s;
        }
        input:focus, textarea:focus { border-color: #6c5ce7; }

        /* –°–µ–∫—Ü–∏—è —Å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–º */
        .toggle-row {
            display: flex; justify-content: space-between; align-items: center;
            background: var(--tg-theme-secondary-bg-color, #2a2a2a);
            padding: 12px 16px; border-radius: 12px;
        }
        .switch { position: relative; display: inline-block; width: 46px; height: 26px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider {
            position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
            background-color: #555; transition: .4s; border-radius: 34px;
        }
        .slider:before {
            position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px;
            background-color: white; transition: .4s; border-radius: 50%;
        }
        input:checked + .slider { background-color: #6c5ce7; }
        input:checked + .slider:before { transform: translateX(20px); }

        .hint { font-size: 11px; color: var(--tg-theme-hint-color, #888); margin-top: 4px; }
        
        /* –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å */
        .divider { height: 1px; background-color: #333; margin: 5px 0; }
    </style>
</head>
<body>

<div class="container">

    <div>
        <label>üè∑ –ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞</label>
        <input type="text" id="title" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Cyber Love">
    </div>

    <div>
        <label>üé∏ –°—Ç–∏–ª—å –º—É–∑—ã–∫–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
        <input type="text" id="style" placeholder="Pop, Rock, 80s synthwave, Opera...">
    </div>

    <div class="divider"></div>

    <div class="toggle-row">
        <span>üéª –¢–æ–ª—å–∫–æ –º—É–∑—ã–∫–∞ (–±–µ–∑ —Å–ª–æ–≤)</span>
        <label class="switch">
            <input type="checkbox" id="instrumental" onchange="toggleFields()">
            <span class="slider"></span>
        </label>
    </div>

    <div id="lyrics-block">
        <div>
            <label>üìù –¢–µ–∫—Å—Ç –ø–µ—Å–Ω–∏ (Lyrics)</label>
            <textarea id="lyrics" rows="5" placeholder="–ö—É–ø–ª–µ—Ç 1:&#10;–Ø –∏–¥—É –ø–æ –≥–æ—Ä–æ–¥—É...&#10;&#10;(–û—Å—Ç–∞–≤—å –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã AI –ø—Ä–∏–¥—É–º–∞–ª —Å–∞–º)"></textarea>
        </div>

        <div style="margin-top: 10px;">
            <label>üí° –û —á–µ–º –ø–µ—Å–Ω—è? (–ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –ø—É—Å—Ç–æ–π)</label>
            <textarea id="desc" rows="2" placeholder="–ì—Ä—É—Å—Ç–Ω–∞—è –ø–µ—Å–Ω—è –ø—Ä–æ –æ—Å–µ–Ω—å –∏ –∫–æ—Ç–∞..."></textarea>
            <div class="hint">–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–æ –æ–ø–∏—Å–∞–Ω–∏–µ, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª–µ ¬´–¢–µ–∫—Å—Ç –ø–µ—Å–Ω–∏¬ª –ø—É—Å—Ç–æ–µ.</div>
        </div>
    </div>

</div>

<script>
    let tg = window.Telegram.WebApp;
    tg.expand();
    tg.MainButton.text = "–°–û–ó–î–ê–¢–¨ –¢–†–ï–ö üöÄ";
    tg.MainButton.show();

    // –§—É–Ω–∫—Ü–∏—è —Å–∫—Ä—ã—Ç–∏—è –ø–æ–ª–µ–π –ø—Ä–∏ –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª–µ
    function toggleFields() {
        let isInst = document.getElementById("instrumental").checked;
        let block = document.getElementById("lyrics-block");
        block.style.opacity = isInst ? "0.3" : "1";
        block.style.pointerEvents = isInst ? "none" : "auto";
    }

    Telegram.WebApp.onEvent('mainButtonClicked', function(){
        let title = document.getElementById("title").value.trim();
        let style = document.getElementById("style").value.trim();
        let lyrics = document.getElementById("lyrics").value.trim();
        let desc = document.getElementById("desc").value.trim();
        let isInst = document.getElementById("instrumental").checked;

        if (!style) {
            tg.showPopup({title: "–û—à–∏–±–∫–∞", message: "–£–∫–∞–∂–∏ —Å—Ç–∏–ª—å –º—É–∑—ã–∫–∏!"});
            return;
        }

        // –õ–æ–≥–∏–∫–∞:
        // mode: 'instrumental' (–µ—Å–ª–∏ –≥–∞–ª–æ—á–∫–∞)
        // mode: 'custom' (–µ—Å–ª–∏ –µ—Å—Ç—å —Ç–µ–∫—Å—Ç –ø–µ—Å–Ω–∏)
        // mode: 'generate' (–µ—Å–ª–∏ —Ç–µ–∫—Å—Ç–∞ –Ω–µ—Ç, –Ω–æ –µ—Å—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ)
        
        let mode = "generate";
        if (isInst) mode = "instrumental";
        else if (lyrics.length > 0) mode = "custom";

        let data = {
            mode: mode,
            title: title || "New Song",
            style: style,
            lyrics: lyrics,
            desc: desc
        };

        tg.sendData(JSON.stringify(data));
    });
</script>
</body>
</html>
